<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>محاسبه انتگرال گام‌به‌گام</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/algebrite/1.5.0/algebrite.min.js"></script>
<style>
    body { font-family: Tahoma, sans-serif; direction: rtl; padding: 20px; background: #f0f0f0; }
    input, button { padding: 10px; width: 320px; margin-top: 10px; font-size: 16px; }
    #result { margin-top: 20px; background: #fff; padding: 15px; border-radius: 10px;
              box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
    .step { margin: 10px 0; }
</style>
</head>
<body>

<h2>محاسبه انتگرال گام‌به‌گام</h2>

<input id="inputExpr" placeholder="مثلاً x^2 یا sin(x) یا 1/(x+1)" />
<br>
<input id="variable" placeholder="متغیر (مثلاً x)" />
<br>
<button onclick="solveIntegral()">محاسبه</button>

<div id="result"></div>

<script>

// تشخیص نوع انتگرال
function detectType(expr){
    if (/sin|cos|tan|cot|sec|csc/.test(expr)) return "مثلثاتی";
    if (/sqrt/.test(expr)) return "رادیکالی";
    if (/log|ln/.test(expr)) return "لگاریتمی";
    if (/\//.test(expr)) return "کسری";
    if (/\^/.test(expr)) return "چندجمله‌ای (توانی)";
    return "عمومی / ساده";
}

function stepsFor(type, expr, variable){
    let s = [];

    s.push(`۱) تشخیص نوع انتگرال → ${type}`);

    switch(type){
        case "چندجمله‌ای (توانی)":
            s.push("۲) تبدیل به فرم x^n و افزایش توان به n+1");
            s.push("۳) تقسیم بر توان جدید (n+1)");
            break;

        case "مثلثاتی":
            s.push("۲) استفاده از جدول انتگرال‌های مثلثاتی");
            s.push("۳) اگر لازم بود تبدیل روابط مثل sin²(x) یا cos²(x)");
            break;

        case "رادیکالی":
            s.push("۲) تبدیل √ به توان کسری مانند x^(1/2)");
            s.push("۳) اعمال قانون انتگرال توانی");
            break;

        case "کسری":
            s.push("۲) بررسی اگر قابل ساده‌سازی باشد");
            s.push("۳) ممکن است از روش تجزیه به کسرهای جزئی استفاده شود");
            break;

        case "لگاریتمی":
            s.push("۲) استفاده از فرمول ∫ ln(x) dx = x ln(x) - x");
            break;

        default:
            s.push("۲) انتگرال مستقیم با قوانین پایه");
    }

    s.push("۴) اضافه کردن ثابت C");
    return s;
}

function solveIntegral(){
    let expr = document.getElementById("inputExpr").value.trim();
    let variable = document.getElementById("variable").value.trim() || "x";
    let r = document.getElementById("result");

    if(expr === ""){
        r.innerHTML = "<b>لطفاً یک عبارت وارد کنید.</b>";
        return;
    }

    let type = detectType(expr);
    let steps = stepsFor(type, expr, variable);

    try {
        // حل انتگرال
        let result = Algebrite.integral(expr, variable).toString();

        // بررسی مشتق
        let derivative = Algebrite.derivative(result, variable).toString();

        // ساخت خروجی
        let output = `<div class="step"><b>نوع انتگرال:</b> ${type}</div>`;
        
        output += `<div class="step"><b>مراحل گام‌به‌گام:</b><br>`;
        steps.forEach(s => output += "• " + s + "<br>");
        output += "</div>";

        output += `<div class="step"><b>جواب نهایی:</b> ${result} + C</div>`;
        output += `<div class="step"><b>بررسی با مشتق:</b> d/d${variable}(${result}) = ${derivative}</div>`;

        r.innerHTML = output;

    } catch(e){
        r.innerHTML = "خطا در محاسبه: " + e;
    }
}

</script>

</body>
</html>
