<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>ماشین حساب مشتق گام‌به‌گام</title>
<style>
body {
  font-family: sans-serif;
  direction: rtl;
  padding: 20px;
}
input {
  width: 300px;
  padding: 8px;
  font-size: 18px;
}
button {
  padding: 8px 16px;
  font-size: 18px;
}
#steps {
  margin-top: 20px;
  white-space: pre-line;
  font-size: 18px;
  background: #f4f4f4;
  padding: 15px;
  border-radius: 8px;
}
</style>
</head>

<body>

<h2>ماشین حساب مشتق گام‌به‌گام</h2>

<input id="expr" placeholder="مثال: 3x^2 + 5x - 7">
<button onclick="calc()">محاسبه</button>

<div id="steps"></div>

<script>

// --- ابزار کمکی ---
function isNumber(str){
    return /^-?\d+(\.\d+)?$/.test(str);
}

// --- مشتق‌گیر اصلی ---
function derivative(expr, steps){
    
    expr = expr.replace(/\s+/g, "");  

    // حالت‌هایی مثل 3x → 3*x
    expr = expr.replace(/(\d)(x)/g, "$1*$2");

    // مشتق چند جمله‌ای
    if(expr.includes("+") || expr.includes("-")){
        let parts = expr.replace(/-/g,"+-").split("+").filter(p=>p!=="");
        let result = [];
        steps.push("تشخیص چندجمله‌ای:");
        parts.forEach(p=>{
            steps.push("مشتق " + p);
            result.push( derivative(p, steps) );
        });
        return result.join(" + ");
    }

    // مشتق a*x^n
    if(/^[0-9\*\.]*x\^\d+$/.test(expr)){
        let [coef, pow] = expr.split("x^");
        coef = coef.replace("*", "") || "1";
        coef = Number(coef);
        pow  = Number(pow);
        steps.push(`قاعده توان: مشتق x^n = n*x^(n-1)`);
        steps.push(`${coef} * x^${pow} → ${coef} * ${pow} * x^${pow-1}`);
        return (coef * pow) + "*x^" + (pow-1);
    }

    // مشتق x
    if(expr === "x"){
        steps.push("مشتق x برابر 1 است");
        return "1";
    }

    // مشتق a*x
    if(/^\d+\*x$/.test(expr)){
        let a = Number(expr.split("*")[0]);
        steps.push("مشتق a*x برابر a است");
        return String(a);
    }

    // مشتق ثابت
    if(isNumber(expr)){
        steps.push("مشتق عدد ثابت همیشه 0 است");
        return "0";
    }

    // مشتق sin(x)
    if(expr === "sin(x)"){
        steps.push("مشتق sin(x) برابر cos(x) است");
        return "cos(x)";
    }

    // مشتق cos(x)
    if(expr === "cos(x)"){
        steps.push("مشتق cos(x) برابر -sin(x) است");
        return "-sin(x)";
    }

    // مشتق √x  →  1/(2√x)
    if(expr === "sqrt(x)"){
        steps.push("مشتق √x برابر 1/(2√x) است");
        return "1/(2*sqrt(x))";
    }

    // مشتق e^x
    if(expr === "e^x"){
        steps.push("مشتق e^x برابر خود e^x است");
        return "e^x";
    }

    return "⚠ ناشناخته";
}


// --- رویداد اصلی ---
function calc(){
    const expr = document.getElementById("expr").value;
    const steps = [];

    const ans = derivative(expr, steps);

    document.getElementById("steps").innerText =
        "ورودی: " + expr + "\n\n" +
        "گام‌ها:\n" + steps.join("\n") +
        "\n\n" + "نتیجه نهایی مشتق:  " + ans;
}

</script>

</body>
</html>
