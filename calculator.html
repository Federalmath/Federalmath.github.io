<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>انتگرال گام به گام پیشرفته</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/algebrite/1.5.0/algebrite.min.js"></script>
<style>
    body { font-family: Tahoma, sans-serif; padding: 20px; direction: rtl; background: #f5f5f5; }
    input, button { padding: 10px; font-size: 16px; margin: 5px 0; width: 350px; }
    #result { margin-top: 20px; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);}
    .step { margin-bottom: 15px; }
    .highlight { background: #e0f7fa; padding: 5px; border-radius: 4px; }
</style>
</head>
<body>

<h2>محاسبه انتگرال گام به گام پیشرفته</h2>

<label>عبارت انتگرال را وارد کنید:</label><br>
<input type="text" id="integralInput" placeholder="مثلاً sin(x) + x^2"><br>

<label>متغیر انتگرال:</label><br>
<input type="text" id="variable" placeholder="مثلاً x"><br>

<button onclick="calculateIntegral()">محاسبه</button>

<div id="result"></div>

<script>
function detectIntegralType(expr) {
    // تشخیص نوع انتگرال به صورت ساده
    if (/sin|cos|tan|cot|sec|csc/.test(expr)) return 'مثلثاتی';
    if (/\^/.test(expr) && !/sin|cos|tan|cot|sec|csc/.test(expr)) return 'توان';
    if (/sqrt/.test(expr)) return 'رادیکال';
    if (/\//.test(expr)) return 'کسری';
    if (/ln|log/.test(expr)) return 'لگاریتمی';
    return 'ساده';
}

function calculateIntegral() {
    const expr = document.getElementById('integralInput').value;
    const variable = document.getElementById('variable').value || 'x';
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '';

    if (!expr) {
        alert('لطفاً یک عبارت وارد کنید.');
        return;
    }

    try {
        // تشخیص نوع انتگرال
        let type = detectIntegralType(expr);
        resultDiv.innerHTML += `<div class="step"><b>نوع انتگرال تشخیص داده شده:</b> ${type}</div>`;

        // مراحل گام به گام
        let steps = [];
        steps.push(`1️⃣ بررسی نوع عبارت: <span class="highlight">${expr}</span>`);
        
        switch(type) {
            case 'مثلثاتی':
                steps.push('2️⃣ روش: استفاده از روابط انتگرال توابع مثلثاتی و جایگزینی مناسب.');
                break;
            case 'توان':
                steps.push('2️⃣ روش: افزایش توان + تقسیم بر توان جدید.');
                break;
            case 'رادیکال':
                steps.push('2️⃣ روش: تبدیل رادیکال به توان کسری و استفاده از قانون انتگرال توان.');
                break;
            case 'کسری':
                steps.push('2️⃣ روش: اگر ساده شود → روش تجزیه کسری جزئی.');
                break;
            case 'لگاریتمی':
                steps.push('2️⃣ روش: استفاده از فرمول‌های انتگرال لگاریتمی.');
                break;
            default:
                steps.push('2️⃣ روش: روش مستقیم و ساده.');
        }

        // محاسبه انتگرال با Algebrite
        let integral = Algebrite.integral(expr, variable).toString();
        steps.push(`3️⃣ حل انتگرال: Algebrite → ${integral}`);
        steps.push(`4️⃣ اضافه کردن ثابت انتگرال: + C`);
        steps.push(`5️⃣ بررسی صحت با مشتق: مشتق جواب ≈ عبارت اولیه`);
        
        // نمایش مراحل
        resultDiv.innerHTML += `<div class="step"><b>مراحل گام به گام:</b><br>${steps.join('<br>')}</div>`;

        // نمایش جواب نهایی
        let finalResult = `${integral} + C`;
        resultDiv.innerHTML += `<div class="step"><b>جواب نهایی:</b> ${finalResult}</div>`;

        // بررسی با گرفتن مشتق
        let derivativeCheck = Algebrite.derivative(integral, variable).toString();
        resultDiv.innerHTML += `<div class="step"><b>بررسی صحت با مشتق:</b> مشتق جواب = ${derivativeCheck} ≈ ${expr}</div>`;

    } catch (err) {
        resultDiv.innerHTML = 'خطا در محاسبه: ' + err;
    }
}
</script>

</body>
</html>
